<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <title>Raw Orientation Sensor Data</title>

    <!-- Apple Web App Meta Tags -->
    <meta name="apple-mobile-web-app-capable" content="yes">
    <meta name="apple-mobile-web-app-status-bar-style" content="black-translucent">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, user-scalable=no, viewport-fit=cover">

    <style>
        body {
            font-family: -apple-system, BlinkMacSystemFont, "Segoe UI", Roboto, Oxygen, Ubuntu, Cantarell, "Open Sans", "Helvetica Neue", sans-serif;
            margin: 0;
            padding: 20px; /* More padding for content */
            background-color: #f0f0f0;
            color: #333;
            overscroll-behavior-y: contain;
            font-size: 16px;
        }
        .container {
            display: flex;
            flex-direction: column;
            gap: 20px; /* Increased gap */
        }
        .permission-section, .sensor-values-display {
            text-align: left; /* Align text left for readability */
            padding: 20px;
            background-color: #fff;
            border-radius: 8px;
            box-shadow: 0 2px 4px rgba(0,0,0,0.1);
        }
        .permission-section {
            text-align: center; /* Keep permission button centered */
        }
        .sensor-values-display h2 {
            margin-top: 0;
            font-size: 1.4em;
            color: #007bff;
            border-bottom: 1px solid #eee;
            padding-bottom: 10px;
            margin-bottom: 15px;
        }
        .sensor-value-item {
            margin-bottom: 12px; /* Space between items */
            display: flex; /* For aligning label and value */
            justify-content: space-between;
            align-items: center;
            padding: 5px 0;
            border-bottom: 1px dashed #f0f0f0;
        }
        .sensor-value-item:last-child {
            border-bottom: none;
        }
        .sensor-value-item strong {
            color: #555;
            margin-right: 10px;
            min-width: 200px; /* Ensure labels align nicely */
        }
        .sensor-value-item span {
            font-family: "SF Mono", "Menlo", "Monaco", "Consolas", "Liberation Mono", "Courier New", monospace;
            font-weight: bold;
            color: #333;
            word-break: break-all; /* Prevent long numbers from breaking layout */
        }
        .controls button { /* Style for permission button */
            padding: 12px 20px;
            border-radius: 5px;
            border: none;
            font-size: 1em;
            background-color: #007bff;
            color: white;
            cursor: pointer;
        }
        .controls button:hover {
            background-color: #0056b3;
        }
        .logs { margin-top: 20px; background-color: #fff; padding: 15px; border-radius: 8px; box-shadow: 0 2px 4px rgba(0,0,0,0.1); }
        .logs h3 { margin-top: 0; }
        .log-area { max-height: 150px; overflow-y: auto; border: 1px solid #ccc; padding: 10px; font-size: 0.8em; background-color: #f9f9f9; white-space: pre-wrap; }
        .log-entry.error { color: red; font-weight: bold; }
        .log-entry.warn { color: orange; }
        .log-entry.debug { color: blue; }
        .log-entry.info { color: green; }
        .hidden { display: none !important; }
    </style>
</head>
<body>
    <div class="container">
        <h1>Raw Device Orientation Data</h1>

        <div id="permissionSection" class="permission-section">
            <p>This app requires access to your device's orientation sensors.</p>
            <div class="controls">
                <button id="requestPermissionButton">Grant Orientation Sensor Access</button>
            </div>
        </div>

        <div id="sensorValuesDisplay" class="sensor-values-display hidden">
            <h2>Live Sensor Values:</h2>
            <div class="sensor-value-item">
                <strong>Alpha (α - Z axis rotation, Compass if absolute):</strong>
                <span id="alphaValue">---</span>
            </div>
            <div class="sensor-value-item">
                <strong>Beta (β - X axis rotation, front-to-back):</strong>
                <span id="betaValue">---</span>
            </div>
            <div class="sensor-value-item">
                <strong>Gamma (γ - Y axis rotation, side-to-side):</strong>
                <span id="gammaValue">---</span>
            </div>
            <div class="sensor-value-item">
                <strong>Absolute Orientation:</strong>
                <span id="absoluteValue">---</span>
            </div>
            <div class="sensor-value-item">
                <strong>WebKit Compass Heading (Legacy):</strong>
                <span id="webkitCompassHeadingValue">---</span>
            </div>
        </div>

        <div class="logs">
            <h3>Event & Error Logs</h3>
            <div id="logArea" class="log-area"></div>
        </div>
    </div>

    <script>
        const logArea = document.getElementById('logArea');
        const permissionSection = document.getElementById('permissionSection');
        const requestPermissionButton = document.getElementById('requestPermissionButton');
        const sensorValuesDisplayDiv = document.getElementById('sensorValuesDisplay');

        // DOM elements for displaying values
        const alphaValueEl = document.getElementById('alphaValue');
        const betaValueEl = document.getElementById('betaValue');
        const gammaValueEl = document.getElementById('gammaValue');
        const absoluteValueEl = document.getElementById('absoluteValue');
        const webkitCompassHeadingValueEl = document.getElementById('webkitCompassHeadingValue');

        let orientationSensorActive = false;
        let orientationEventListenerType = null; // To track which listener is active

        function logMessage(message, type = 'info') {
            const entry = document.createElement('div');
            entry.classList.add('log-entry', type); // Assign class based on type for styling
            entry.textContent = `[${new Date().toLocaleTimeString()}] ${type.toUpperCase()}: ${message}`;
            logArea.appendChild(entry);
            logArea.scrollTop = logArea.scrollHeight;
        }

        function formatSensorValue(value, precision = 6) {
            if (value === null || typeof value === 'undefined') {
                return '---';
            }
            if (typeof value === 'boolean') {
                return value.toString();
            }
            if (typeof value === 'number') {
                // Show many decimal places, but avoid excessively long strings for NaN or Infinity
                if (isNaN(value) || !isFinite(value)) {
                    return value.toString();
                }
                return value.toFixed(precision); // Display with specified precision
            }
            return String(value); // Fallback for other types
        }

        function handleDeviceOrientation(event) {
            if (!orientationSensorActive) {
                logMessage(`First ${orientationEventListenerType || 'deviceorientation'} event received. Displaying data.`, 'info');
                orientationSensorActive = true;
                sensorValuesDisplayDiv.classList.remove('hidden'); // Show display on first event
            }

            // Log the raw event object once to see all available properties
            if (orientationSensorActive && !window.orientationEventLogged) {
                console.log("Full DeviceOrientationEvent object:", event);
                logMessage("Full DeviceOrientationEvent object logged to browser console.", 'debug');
                window.orientationEventLogged = true; // Log only once
            }

            alphaValueEl.textContent = formatSensorValue(event.alpha);
            betaValueEl.textContent = formatSensorValue(event.beta);
            gammaValueEl.textContent = formatSensorValue(event.gamma);
            absoluteValueEl.textContent = formatSensorValue(event.absolute);
            webkitCompassHeadingValueEl.textContent = formatSensorValue(event.webkitCompassHeading);

            // More detailed logging for debugging if needed
            // logMessage(`DEBUG: alpha=${event.alpha}, beta=${event.beta}, gamma=${event.gamma}, abs=${event.absolute}, webkitCH=${event.webkitCompassHeading}`, 'debug');
        }

        function requestOrientationPermission() {
            logMessage('Attempting to request orientation sensor permission...', 'info');
            if (typeof DeviceOrientationEvent !== 'undefined' && typeof DeviceOrientationEvent.requestPermission === 'function') {
                DeviceOrientationEvent.requestPermission()
                    .then(permissionState => {
                        logMessage(`Orientation permission state: ${permissionState}`, 'info');
                        if (permissionState === 'granted') {
                            orientationEventListenerType = 'deviceorientationabsolute'; // Prefer this
                            window.addEventListener('deviceorientationabsolute', handleDeviceOrientation, true);
                            // Add standard listener as fallback or for devices that only support it
                            window.addEventListener('deviceorientation', (e) => {
                                if (orientationEventListenerType !== 'deviceorientationabsolute' || !orientationSensorActive) {
                                    orientationEventListenerType = 'deviceorientation'; // Log which type if 'absolute' isn't firing first
                                }
                                handleDeviceOrientation(e);
                            }, true);
                            permissionSection.classList.add('hidden');
                            // Sensor display will be shown by handleDeviceOrientation on first event
                        } else {
                            logMessage('Orientation sensor permission denied by user.', 'error');
                            alert('Permission denied. Sensor data will not be available.');
                        }
                    })
                    .catch(error => {
                        logMessage(`Error requesting orientation permission: ${error.name} - ${error.message}`, 'error');
                        alert('An error occurred while requesting permission: ' + error.message);
                    });
            } else if (typeof DeviceOrientationEvent !== 'undefined') {
                logMessage('DeviceOrientationEvent available (no specific permission needed or already granted). Adding listeners.', 'info');
                orientationEventListenerType = 'deviceorientationabsolute';
                window.addEventListener('deviceorientationabsolute', handleDeviceOrientation, true);
                window.addEventListener('deviceorientation', (e) => {
                     if (orientationEventListenerType !== 'deviceorientationabsolute' || !orientationSensorActive) {
                        orientationEventListenerType = 'deviceorientation';
                    }
                    handleDeviceOrientation(e);
                }, true);
                permissionSection.classList.add('hidden');
                // Sensor display will be shown by handleDeviceOrientation on first event
            } else {
                logMessage('DeviceOrientationEvent API not supported on this browser.', 'error');
                alert('Device Orientation API not supported. This app will not work.');
                sensorValuesDisplayDiv.classList.remove('hidden'); // Show it anyway, values will be '---'
                alphaValueEl.textContent = "API N/A";
                betaValueEl.textContent = "API N/A";
                gammaValueEl.textContent = "API N/A";
                absoluteValueEl.textContent = "API N/A";
                webkitCompassHeadingValueEl.textContent = "API N/A";
            }
        }

        window.addEventListener('load', () => {
            logMessage('App loaded. HTTPS: ' + (window.location.protocol === "https:" ? "Yes" : "No - WARNING: Sensors may not work on HTTP"), 'info');
            requestPermissionButton.addEventListener('click', requestOrientationPermission);

            if (window.navigator.standalone === true) {
                logMessage('Running in PWA mode (iOS).', 'info');
            }
            // Sensor display div is initially hidden, shown on first sensor event after permission
        });
    </script>
</body>
</html>